<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SmartPark Pro - Intelligent Parking System</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=Space+Mono:wght@400;700&family=Manrope:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="styles.css">
</head>
<body>

<!-- TOAST CONTAINER -->
<div class="toast-container" id="toastContainer"></div>

<!-- SPLASH SCREEN -->
<div id="splashScreen" style="display:none">
  <div id="splashIcon" style="font-size:84px">ğŸ…¿ï¸</div>
  <div id="splashTitle" style="font-family:'Syne',sans-serif;font-size:38px;font-weight:800;margin-top:18px">SmartPark Pro</div>
  <div id="splashSub" style="font-size:12px;color:#6b8a9e;letter-spacing:3px;text-transform:uppercase;margin-top:6px">Intelligent Parking System</div>
  <div id="splashGreeting" style="font-size:13px;margin-top:28px;padding:9px 24px;border-radius:30px">Welcome!</div>
  <div id="splashLoader" style="width:160px;height:3px;background:rgba(255,255,255,0.07);border-radius:2px;margin-top:38px;overflow:hidden">
    <div id="splashFill" style="height:100%;border-radius:2px;width:0%"></div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     LOGIN PAGE  (properly closed before mainApp)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="loginPage" class="login-page">
  <div class="login-card">
    <div class="login-logo">ğŸ…¿ï¸</div>
    <h2 class="login-title">SmartPark Pro</h2>
    <p class="login-sub">Intelligent Parking Management System</p>

    <!-- Login/Register/Admin tabs -->
    <div class="login-tabs">
      <div class="login-tab active" id="tabUser"  onclick="switchLoginTab('user')">User Login</div>
      <div class="login-tab" id="tabReg"   onclick="switchLoginTab('register')">Register</div>
      <div class="login-tab" id="tabAdmin" onclick="switchLoginTab('admin')">Admin</div>
    </div>

    <!-- Error -->
    <div id="loginError" style="background:rgba(255,23,68,0.1);border:1px solid rgba(255,23,68,0.3);border-radius:8px;padding:10px 14px;font-size:13px;color:var(--red);margin-bottom:14px;display:none"></div>

    <!-- â”€â”€ USER LOGIN FORM â”€â”€ -->
    <div id="loginForm">
      <div class="form-group">
        <label class="form-label">Email</label>
        <input type="email" class="form-input" id="loginEmail" placeholder="your@email.com">
      </div>
      <div class="form-group">
        <label class="form-label">Password</label>
        <input type="password" class="form-input" id="loginPassword" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" onkeydown="if(event.key==='Enter')handleLogin()">
      </div>
      <button class="btn btn-primary" style="width:100%;padding:13px;font-size:15px;justify-content:center" onclick="handleLogin()">ğŸ” Sign In</button>
      <div class="divider">test credentials</div>
      <div style="background:var(--bg2);border:1px solid var(--border);border-radius:8px;padding:12px;font-size:12px;color:var(--muted);font-family:'Space Mono',monospace">
        <div id="credHint">Loading credentials...</div>
      </div>
    </div>

    <!-- â”€â”€ REGISTER FORM â”€â”€ -->
    <div id="registerForm" class="hidden">
      <div class="form-group">
        <label class="form-label">Full Name *</label>
        <input type="text" class="form-input" id="regName" placeholder="Your name">
      </div>
      <div class="form-group">
        <label class="form-label">Email *</label>
        <input type="email" class="form-input" id="regEmail" placeholder="your@email.com">
      </div>
      <div class="form-group">
        <label class="form-label">Password *</label>
        <input type="password" class="form-input" id="regPass" placeholder="Min 6 characters">
      </div>
      <div class="form-group">
        <label class="form-label">Confirm Password *</label>
        <input type="password" class="form-input" id="regPass2" placeholder="Re-enter password" onkeydown="if(event.key==='Enter')handleRegister()">
      </div>
      <button class="btn btn-primary" style="width:100%;padding:13px;font-size:15px;justify-content:center" onclick="handleRegister()">ğŸš€ Create Account</button>
      <div style="text-align:center;margin-top:12px;font-size:12px;color:var(--muted)">Already have an account? <span onclick="switchLoginTab('user')" style="color:var(--p);cursor:pointer">Sign In</span></div>
    </div>

    <!-- â”€â”€ ADMIN LOGIN FORM â”€â”€ -->
    <div id="adminLoginForm" class="hidden">
      <div style="background:rgba(255,107,43,0.08);border:1px solid rgba(255,107,43,0.2);border-radius:8px;padding:10px 14px;font-size:12px;color:var(--accent);margin-bottom:16px">ğŸ›¡ï¸ Admin access only. Credentials are restricted.</div>
      <div class="form-group">
        <label class="form-label">Admin Email</label>
        <input type="email" class="form-input" id="adminEmail" placeholder="admin@smartpark.com">
      </div>
      <div class="form-group">
        <label class="form-label">Admin Password</label>
        <input type="password" class="form-input" id="adminPass" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" onkeydown="if(event.key==='Enter')handleAdminLogin()">
      </div>
      <button class="btn btn-primary" style="width:100%;padding:13px;font-size:15px;justify-content:center" onclick="handleAdminLogin()">ğŸ›¡ï¸ Admin Login</button>
    </div>

    <div style="text-align:center;margin-top:14px">
      <button onclick="clearAllData()" style="background:none;border:none;cursor:pointer;font-size:11px;color:var(--muted);text-decoration:underline">ğŸ”„ Reset App Data (if stuck)</button>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     MAIN APP (sibling of loginPage â€” NOT nested inside it)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="mainApp" class="hidden">
  <div class="sidebar">
    <div class="sidebar-header">
      <div class="sidebar-logo-wrap">
        <div class="logo-icon">ğŸ…¿ï¸</div>
        <div><div class="sidebar-brand">SmartPark</div><div class="sidebar-sub">Pro</div></div>
      </div>
    </div>
    <div class="sidebar-menu">
      <div class="menu-section">Main</div>
      <div class="menu-item active" data-sec="dashboard" onclick="showSection('dashboard',this)"><span class="menu-icon">ğŸ“Š</span><span class="menu-label">Dashboard</span></div>
      <div class="menu-item" data-sec="parking" onclick="showSection('parking',this)"><span class="menu-icon">ğŸ’¾</span><span class="menu-label">Save Parking</span></div>
      <div class="menu-item" data-sec="find" onclick="showSection('find',this)"><span class="menu-icon">ğŸ—ºï¸</span><span class="menu-label">Find My Car</span></div>
      <div class="menu-section">Manage</div>
      <div class="menu-item" data-sec="vehicles" onclick="showSection('vehicles',this)"><span class="menu-icon">ğŸš—</span><span class="menu-label">My Vehicles</span></div>
      <div class="menu-item" data-sec="active" onclick="showSection('active',this)"><span class="menu-icon">ğŸ“‹</span><span class="menu-label">Active Sessions</span></div>
      <div class="menu-item" data-sec="history" onclick="showSection('history',this)"><span class="menu-icon">ğŸ“œ</span><span class="menu-label">History</span></div>
      <div class="menu-section">Account</div>
      <div class="menu-item" data-sec="premium" onclick="showSection('premium',this)"><span class="menu-icon">â­</span><span class="menu-label">Premium Plans</span></div>
      <div class="menu-item admin-only hidden" data-sec="admin" onclick="showSection('admin',this)"><span class="menu-icon">ğŸ›¡ï¸</span><span class="menu-label">Admin Panel</span><span class="menu-badge" id="adminBadge">0</span></div>
      <div class="menu-item admin-only hidden" data-sec="slotmap" onclick="showSection('slotmap',this)"><span class="menu-icon">ğŸ—ºï¸</span><span class="menu-label">Slot Map View</span></div>
    </div>
    <div class="user-profile">
      <div class="user-avatar" id="userAvatar">P</div>
      <div class="user-info">
        <div class="user-name" id="userName">User</div>
        <div class="user-tier"><span class="tier-badge tier-free" id="tierBadge">Free</span></div>
      </div>
    </div>
  </div>

  <div class="main-content">
    <div class="top-bar">
      <div>
        <div class="page-heading" id="pageTitle">Dashboard</div>
        <div class="page-sub" id="pageSub">Welcome back!</div>
      </div>
      <div class="top-actions">
        <button class="btn btn-ghost btn-sm" onclick="logout()">Logout</button>
        <button class="btn btn-primary" onclick="showSection('parking',null)">+ New Parking</button>
      </div>
    </div>

    <!-- â”€â”€ DASHBOARD â”€â”€ -->
    <div id="sec-dashboard">
      <!-- Premium Status Banner -->
      <div id="premiumBanner" class="hidden" style="background:linear-gradient(135deg,rgba(168,85,247,0.15),rgba(99,102,241,0.1));border:1px solid rgba(168,85,247,0.4);border-radius:12px;padding:16px;margin-bottom:20px;display:flex;align-items:center;gap:14px">
        <div style="font-size:32px" id="premiumBannerIcon">â­</div>
        <div>
          <div style="font-family:'Syne',sans-serif;font-weight:800;font-size:16px" id="premiumBannerTitle">Premium Active</div>
          <div style="font-size:12px;color:var(--muted);margin-top:3px" id="premiumBannerDesc">20h free parking â€¢ â‚¹300/hr overtime</div>
        </div>
      </div>
      <!-- Outstanding Fines Banner -->
      <div id="outstandingFinesBanner" class="hidden" style="background:rgba(255,23,68,0.08);border:1px solid rgba(255,23,68,0.3);border-radius:12px;padding:16px;margin-bottom:20px;display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:10px">
        <div style="display:flex;align-items:center;gap:12px">
          <div style="font-size:28px">ğŸ’¸</div>
          <div>
            <div style="font-weight:700;color:var(--red)">Outstanding Fines</div>
            <div style="font-size:12px;color:var(--muted)" id="outstandingFinesAmt">You have unpaid fines</div>
          </div>
        </div>
        <button class="btn btn-danger btn-sm" onclick="showSection('active',null)">Pay Now â†’</button>
      </div>
      <div class="stats-grid" id="statsGrid">
        <div class="stat-card cyan"><div class="stat-icon">ğŸ…¿ï¸</div><div class="stat-value cyan" id="sTotalP">0</div><div class="stat-label">Total Parkings</div></div>
        <div class="stat-card green"><div class="stat-icon">ğŸŸ¢</div><div class="stat-value green" id="sActiveP">0</div><div class="stat-label">Active Sessions</div></div>
        <div class="stat-card orange"><div class="stat-icon">ğŸš—</div><div class="stat-value orange" id="sVehicles">0</div><div class="stat-label">My Vehicles</div></div>
        <div class="stat-card purple"><div class="stat-icon">â­</div><div class="stat-value purple" id="sTier">Free</div><div class="stat-label">Membership</div></div>
      </div>
      <div class="grid-2" style="margin-bottom:20px">
        <div class="chart-wrap"><canvas id="activityChart" style="max-height:220px"></canvas></div>
        <div class="chart-wrap"><canvas id="facilityChart" style="max-height:220px"></canvas></div>
      </div>
      <div class="card card-glow">
        <div class="card-header"><h3 class="card-title">ğŸ• Recent Activity</h3></div>
        <div id="recentActivity"></div>
      </div>
    </div>

    <!-- â”€â”€ SAVE PARKING â”€â”€ -->
    <div id="sec-parking" class="hidden">
      <div class="card card-glow">
        <h3 class="card-title" style="margin-bottom:20px">ğŸ’¾ Save Parking Location</h3>
        <div class="grid-2">
          <div class="form-group"><label class="form-label">State</label>
            <select class="form-select" id="state" onchange="updateCities()">
              <option value="">Select State</option>
              <option value="Maharashtra">Maharashtra</option>
            </select>
          </div>
          <div class="form-group"><label class="form-label">City</label>
            <select class="form-select" id="city" onchange="updateFacilities()" disabled><option value="">Select City</option></select>
          </div>
        </div>
        <div class="form-group"><label class="form-label">Parking Facility</label>
          <select class="form-select" id="facility" onchange="updateAreas()" disabled><option value="">Select Facility</option></select>
        </div>
        <div class="grid-2">
          <div class="form-group"><label class="form-label">My Vehicle</label>
            <select class="form-select" id="selectedVehicle"><option value="">Select Vehicle</option></select>
          </div>
          <div class="form-group"><label class="form-label">Parking Area</label>
            <select class="form-select" id="area" onchange="updateSlots()"><option value="">Select Area</option></select>
          </div>
        </div>
        <div id="parkingMapContainer" class="parking-map-container hidden">
          <div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:10px;margin-bottom:14px">
            <div style="font-weight:700;font-size:15px">ğŸ—ºï¸ Area: <span id="currentArea" style="color:var(--p)"></span></div>
            <div class="map-legend">
              <div class="legend-item"><div class="legend-dot" style="background:rgba(0,230,118,0.5);border:1px solid var(--green)"></div>Available</div>
              <div class="legend-item"><div class="legend-dot" style="background:rgba(255,23,68,0.4);border:1px solid var(--red)"></div>Occupied</div>
              <div class="legend-item"><div class="legend-dot" style="background:rgba(0,212,255,0.4);border:1px solid var(--p)"></div>Selected</div>
            </div>
          </div>
          <div style="font-size:12px;color:var(--muted);margin-bottom:12px">Click a green slot to select</div>
          <div class="parking-grid" id="parkingGrid"></div>
          <div id="selectedSlotInfo" style="margin-top:12px;font-size:13px;color:var(--p);font-weight:600;display:none">âœ… Slot <span id="selectedSlotNum"></span> selected</div>
        </div>
        <div class="form-group"><label class="form-label">Entry Gate</label>
          <select class="form-select" id="entry"><option value="">Select Entry Gate</option></select>
        </div>
        <button class="btn btn-primary" style="width:100%;padding:13px;font-size:15px;justify-content:center" onclick="saveParking()">ğŸ’¾ Confirm & Save Parking</button>
      </div>
    </div>

    <!-- â”€â”€ FIND MY CAR â”€â”€ -->
    <div id="sec-find" class="hidden">
      <div id="findCarContent"></div>
    </div>

    <!-- â”€â”€ VEHICLES â”€â”€ -->
    <div id="sec-vehicles" class="hidden">
      <div class="card card-glow">
        <div class="card-header">
          <h3 class="card-title">ğŸš— My Vehicles</h3>
          <button class="btn btn-primary btn-sm" onclick="openModal('addVehicleModal')">+ Add Vehicle</button>
        </div>
        <div id="vehiclesList"></div>
      </div>
    </div>

    <!-- â”€â”€ ACTIVE SESSIONS â”€â”€ -->
    <div id="sec-active" class="hidden">
      <div class="card card-glow">
        <div class="card-header"><h3 class="card-title">ğŸ“‹ Active Parking Sessions</h3></div>
        <div id="activeParkingsList"></div>
      </div>
    </div>

    <!-- â”€â”€ HISTORY â”€â”€ -->
    <div id="sec-history" class="hidden">
      <div class="card card-glow">
        <div class="card-header"><h3 class="card-title">ğŸ“œ Parking History</h3></div>
        <div id="historyList"></div>
      </div>
    </div>

    <!-- â”€â”€ PREMIUM â”€â”€ -->
    <div id="sec-premium" class="hidden">
      <div class="card card-glow" style="margin-bottom:20px">
        <h3 class="card-title" style="margin-bottom:6px">â­ SmartPark Plans</h3>
        <p style="font-size:13px;color:var(--muted);margin-bottom:20px">Choose the plan that works best for you</p>
        <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:16px">
          <!-- FREE -->
          <div class="plan-card free" onclick="selectPlan('free')" id="planFree">
            <div style="font-family:'Syne',sans-serif;font-size:16px;font-weight:800">Free Plan</div>
            <div class="plan-price">â‚¹0</div>
            <div style="font-size:12px;color:var(--muted);margin-bottom:16px">Forever free</div>
            <div class="plan-feature"><span class="tick">âœ“</span> 12 free parking hours</div>
            <div class="plan-feature"><span class="tick">âœ“</span> 1 vehicle registration</div>
            <div class="plan-feature"><span class="tick">âœ“</span> Basic parking map</div>
            <div class="plan-feature"><span class="cross">âœ—</span> <span style="color:var(--muted)">Extended hours</span></div>
            <div class="plan-feature"><span class="cross">âœ—</span> <span style="color:var(--muted)">Family pack</span></div>
            <div class="plan-feature" style="color:var(--red)"><span>âš ï¸</span> Warning at 10h (2h left)</div>
            <div class="plan-feature" style="color:var(--red)"><span>ğŸ’¸</span> â‚¹500/hr fine (after 12h)</div>
          </div>
          <!-- PREMIUM -->
          <div class="plan-card premium" onclick="selectPlan('premium')" id="planPremium">
            <div style="font-family:'Syne',sans-serif;font-size:16px;font-weight:800;color:var(--premium)">Premium Plan</div>
            <div class="plan-price" style="color:var(--premium)">â‚¹399 <span style="font-size:14px;color:var(--muted)">/2 months</span></div>
            <div style="font-size:12px;color:var(--muted);margin-bottom:16px">â‚¹200/month equivalent</div>
            <div class="plan-feature"><span class="tick">âœ“</span> <strong>20 free parking hours</strong></div>
            <div class="plan-feature"><span class="tick">âœ“</span> Up to 5 vehicles</div>
            <div class="plan-feature"><span class="tick">âœ“</span> Priority slot booking</div>
            <div class="plan-feature"><span class="tick">âœ“</span> Warning at 18h (2h left)</div>
            <div class="plan-feature"><span class="cross">âœ—</span> <span style="color:var(--muted)">Family pack included</span></div>
            <div class="plan-feature" style="color:var(--warning)"><span>ğŸ’¸</span> â‚¹300/hr fine (after 20h)</div>
          </div>
          <!-- FAMILY PACK -->
          <div class="plan-card" onclick="selectPlan('family')" id="planFamily" style="border:2px solid rgba(255,215,0,0.5);background:linear-gradient(135deg,rgba(255,215,0,0.06),rgba(255,140,0,0.04));position:relative;overflow:hidden">
            <div style="position:absolute;top:12px;right:12px;background:linear-gradient(135deg,#ffd700,#ff8c00);color:#000;font-size:10px;font-weight:800;padding:3px 8px;border-radius:4px;letter-spacing:1px">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ FAMILY</div>
            <div style="font-family:'Syne',sans-serif;font-size:16px;font-weight:800;color:var(--gold)">Family Pack</div>
            <div class="plan-price" style="color:var(--gold)">â‚¹999 <span style="font-size:14px;color:var(--muted)">/2 months</span></div>
            <div style="font-size:12px;color:var(--muted);margin-bottom:16px">For up to 3 users â€¢ Best for families</div>
            <div class="plan-feature"><span class="tick">âœ“</span> <strong style="color:var(--gold)">â™¾ï¸ UNLIMITED parking time</strong></div>
            <div class="plan-feature"><span class="tick">âœ“</span> 3 family members included</div>
            <div class="plan-feature"><span class="tick">âœ“</span> Up to 5 vehicles per member</div>
            <div class="plan-feature"><span class="tick">âœ“</span> Priority slot booking</div>
            <div class="plan-feature"><span class="tick">âœ“</span> All premium features</div>
            <div class="plan-feature" style="color:var(--green)"><span>âœ…</span> <strong>Zero overtime fines EVER</strong></div>
          </div>
        </div>
      </div>
      <!-- FAMILY PACK MEMBERS -->
      <div class="card card-glow" id="familyPackSection">
        <div class="card-header">
          <h3 class="card-title">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ Family Pack Members</h3>
          <span class="badge" id="familyPlanBadge" style="background:rgba(255,215,0,0.15);color:var(--gold);border:1px solid rgba(255,215,0,0.3)">Family Plan</span>
        </div>
        <div id="familyPackContent"></div>
      </div>
    </div>

    <!-- â”€â”€ ADMIN PANEL â”€â”€ -->
    <div id="sec-admin" class="hidden">
      <div class="admin-header">
        <div class="admin-badge-big">ğŸ›¡ï¸</div>
        <div>
          <div style="font-family:'Syne',sans-serif;font-size:20px;font-weight:800">Admin Control Center</div>
          <div style="font-size:13px;color:var(--muted);margin-top:4px">Manage parkings, fines & overtime alerts</div>
        </div>
      </div>
      <div class="stats-grid" id="adminStatsGrid"></div>
      <div class="card card-glow" id="overtimeAlertsCard">
        <div class="card-header">
          <h3 class="card-title">ğŸ”” Overtime Alerts</h3>
          <div class="notif-dot" id="notifDot" style="display:none"></div>
        </div>
        <div id="overtimeAlertsList"></div>
      </div>
      <div class="card card-glow">
        <div class="card-header">
          <h3 class="card-title">ğŸ“‹ All Active Parkings</h3>
          <input type="text" class="form-input" id="adminSearch" placeholder="Search by ID or vehicle..." style="width:200px" oninput="renderAdminParkings()">
        </div>
        <div id="adminParkingsList"></div>
      </div>
      <div class="card card-glow">
        <div class="card-header"><h3 class="card-title">ğŸ’° Fine Collection Log</h3></div>
        <div id="fineLog"></div>
      </div>
    </div>

    <!-- â”€â”€ ADMIN SLOT MAP â”€â”€ -->
    <div id="sec-slotmap" class="hidden">
      <div class="admin-header">
        <div class="admin-badge-big">ğŸ—ºï¸</div>
        <div>
          <div style="font-family:'Syne',sans-serif;font-size:20px;font-weight:800">Live Slot Map View</div>
          <div style="font-size:13px;color:var(--muted);margin-top:4px">Real-time slot availability</div>
        </div>
        <div style="margin-left:auto;display:flex;align-items:center;gap:8px">
          <div class="notif-dot" style="display:block"></div>
          <span style="font-size:12px;color:var(--muted)">Live</span>
        </div>
      </div>
      <div class="card card-glow">
        <div class="grid-3">
          <div class="form-group" style="margin-bottom:0"><label class="form-label">City</label>
            <select class="form-select" id="adminCity" onchange="adminUpdateFacilities()">
              <option value="">All Cities</option>
              <option value="Mumbai">Mumbai</option>
              <option value="Pune">Pune</option>
              <option value="Nagpur">Nagpur</option>
              <option value="Nashik">Nashik</option>
            </select>
          </div>
          <div class="form-group" style="margin-bottom:0"><label class="form-label">Facility</label>
            <select class="form-select" id="adminFacility" onchange="adminUpdateAreas()"><option value="">Select Facility</option></select>
          </div>
          <div class="form-group" style="margin-bottom:0"><label class="form-label">Area</label>
            <select class="form-select" id="adminArea" onchange="renderAdminSlotMap()"><option value="">Select Area</option></select>
          </div>
        </div>
      </div>
      <div class="stats-grid" id="slotMapStats" style="margin-bottom:20px"></div>
      <div class="card card-glow" id="adminSlotMapCard">
        <div class="card-header">
          <h3 class="card-title" id="slotMapTitle">Select a facility and area to view</h3>
          <div style="display:flex;gap:12px;align-items:center;flex-wrap:wrap">
            <div style="display:flex;align-items:center;gap:6px;font-size:12px;color:var(--muted)"><div style="width:14px;height:14px;border-radius:3px;background:rgba(0,230,118,0.3);border:1px solid var(--green)"></div>Available</div>
            <div style="display:flex;align-items:center;gap:6px;font-size:12px;color:var(--muted)"><div style="width:14px;height:14px;border-radius:3px;background:rgba(255,23,68,0.3);border:1px solid var(--red)"></div>Occupied</div>
            <div style="display:flex;align-items:center;gap:6px;font-size:12px;color:var(--muted)"><div style="width:14px;height:14px;border-radius:3px;background:rgba(255,171,0,0.3);border:1px solid var(--warning)"></div>Overtime</div>
            <button class="btn btn-ghost btn-sm" onclick="renderAdminSlotMap()">ğŸ”„ Refresh</button>
          </div>
        </div>
        <div id="adminSlotMapGrid" style="display:grid;grid-template-columns:repeat(10,1fr);gap:8px;margin-top:8px"></div>
        <div id="slotUserPanel" style="margin-top:20px;display:none">
          <div style="height:1px;background:var(--border);margin-bottom:16px"></div>
          <div style="font-size:12px;color:var(--muted);letter-spacing:1px;text-transform:uppercase;font-weight:700;margin-bottom:10px">Slot Details</div>
          <div id="slotUserInfo" style="background:var(--bg2);border:1px solid var(--border);border-radius:10px;padding:16px"></div>
        </div>
      </div>
      <div class="card card-glow" id="adminAreaUsersCard" style="display:none">
        <div class="card-header">
          <h3 class="card-title" id="adminAreaUsersTitle">Active Users in Area</h3>
          <button class="btn btn-ghost btn-sm" onclick="exportAreaCSV()">ğŸ“¤ Export CSV</button>
        </div>
        <div style="overflow-x:auto">
          <table id="adminAreaTable" style="width:100%;border-collapse:collapse;font-size:13px">
            <thead>
              <tr style="border-bottom:1px solid var(--border);color:var(--muted);font-size:11px;text-transform:uppercase;letter-spacing:1px">
                <th style="padding:10px 12px;text-align:left;font-weight:700">Slot</th>
                <th style="padding:10px 12px;text-align:left;font-weight:700">User</th>
                <th style="padding:10px 12px;text-align:left;font-weight:700">Vehicle</th>
                <th style="padding:10px 12px;text-align:left;font-weight:700">Duration</th>
                <th style="padding:10px 12px;text-align:left;font-weight:700">Plan</th>
                <th style="padding:10px 12px;text-align:left;font-weight:700">Status</th>
                <th style="padding:10px 12px;text-align:left;font-weight:700">Actions</th>
              </tr>
            </thead>
            <tbody id="adminAreaTableBody"></tbody>
          </table>
        </div>
      </div>
    </div>

  </div><!-- /main-content -->
</div><!-- /mainApp -->

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• MODALS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="addVehicleModal" class="modal hidden" onclick="if(event.target===this)closeModal('addVehicleModal')">
  <div class="modal-content">
    <h3 class="modal-title">ğŸš— Add New Vehicle</h3>
    <div class="form-group"><label class="form-label">Vehicle Number *</label>
      <input type="text" class="form-input" id="vehicleNumber" placeholder="MH12AB1234" style="text-transform:uppercase">
    </div>
    <div class="grid-2">
      <div class="form-group"><label class="form-label">Type *</label>
        <select class="form-select" id="vehicleType">
          <option value="car">ğŸš— Car</option>
          <option value="bike">ğŸï¸ Bike</option>
          <option value="truck">ğŸš› Truck</option>
        </select>
      </div>
      <div class="form-group"><label class="form-label">Friendly Name</label>
        <input type="text" class="form-input" id="vehicleName" placeholder="e.g. Honda City">
      </div>
    </div>
    <div style="display:flex;gap:10px;margin-top:8px">
      <button class="btn btn-ghost" style="flex:1;justify-content:center" onclick="closeModal('addVehicleModal')">Cancel</button>
      <button class="btn btn-primary" style="flex:1;justify-content:center" onclick="addVehicle()">âœ… Add Vehicle</button>
    </div>
  </div>
</div>

<div id="ticketModal" class="modal hidden" onclick="if(event.target===this)closeModal('ticketModal')">
  <div class="modal-content" style="max-width:400px">
    <div class="ticket-wrapper">
      <div class="ticket-top">
        <div style="font-size:11px;letter-spacing:2px;color:rgba(255,255,255,0.7);text-transform:uppercase;margin-bottom:8px">Parking Ticket</div>
        <div class="ticket-id" id="tId">PKG000001</div>
        <div class="ticket-time" id="tTime"></div>
      </div>
      <div class="ticket-dashes"></div>
      <div id="qrWrap" style="display:flex;justify-content:center;padding:16px;background:white;"></div>
      <div class="ticket-dashes"></div>
      <div class="ticket-body" id="tBody"></div>
    </div>
    <button class="btn btn-ghost" style="width:100%;justify-content:center;margin-top:16px" onclick="closeModal('ticketModal')">Close</button>
  </div>
</div>

<!-- ADMIN APPLY FINE MODAL -->
<div id="applyFineModal" class="modal hidden" onclick="if(event.target===this)closeModal('applyFineModal')">
  <div class="modal-content">
    <h3 class="modal-title">ğŸ’° Apply Fine</h3>
    <div id="fineModalInfo" style="background:var(--bg2);border:1px solid var(--border);border-radius:10px;padding:14px;margin-bottom:16px;font-size:13px;line-height:2"></div>
    <div class="form-group"><label class="form-label">Fine Amount (â‚¹)</label>
      <input type="number" class="form-input" id="fineAmount" placeholder="500">
    </div>
    <div class="form-group"><label class="form-label">Reason</label>
      <select class="form-select" id="fineReason">
        <option value="Overtime parking">Overtime parking</option>
        <option value="Wrong slot">Wrong slot</option>
        <option value="No ticket">No ticket displayed</option>
        <option value="Blocking emergency">Blocking emergency access</option>
        <option value="Unauthorized area">Parking in unauthorized area</option>
        <option value="Other">Other</option>
      </select>
    </div>
    <div class="form-group"><label class="form-label">Additional Notes</label>
      <textarea class="form-textarea" id="fineNotes" rows="2" placeholder="Optional notes..."></textarea>
    </div>
    <div style="display:flex;gap:10px;margin-top:8px">
      <button class="btn btn-ghost" style="flex:1;justify-content:center" onclick="closeModal('applyFineModal')">Cancel</button>
      <button class="btn btn-danger" style="flex:1;justify-content:center" onclick="confirmFine()">ğŸ’¸ Apply Fine</button>
    </div>
  </div>
</div>

<!-- USER PAY FINE MODAL -->
<div id="payFineModal" class="modal hidden" onclick="if(event.target===this)closeModal('payFineModal')">
  <div class="modal-content" style="max-width:420px">
    <h3 class="modal-title">ğŸ’³ Pay Fine</h3>
    <div id="payFineInfo" style="background:rgba(255,23,68,0.08);border:1px solid rgba(255,23,68,0.25);border-radius:10px;padding:16px;margin-bottom:20px;font-size:13px;line-height:1.8"></div>
    <div style="font-size:13px;font-weight:600;margin-bottom:12px">Select Payment Method:</div>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:20px">
      <div onclick="setPayMethod('upi')" id="payUPI" style="border:2px solid var(--border);border-radius:10px;padding:14px;text-align:center;cursor:pointer;transition:all 0.2s">
        <div style="font-size:24px;margin-bottom:6px">ğŸ“±</div>
        <div style="font-size:13px;font-weight:600">UPI / QR</div>
        <div style="font-size:11px;color:var(--muted)">Instant</div>
      </div>
      <div onclick="setPayMethod('card')" id="payCard" style="border:2px solid var(--border);border-radius:10px;padding:14px;text-align:center;cursor:pointer;transition:all 0.2s">
        <div style="font-size:24px;margin-bottom:6px">ğŸ’³</div>
        <div style="font-size:13px;font-weight:600">Card</div>
        <div style="font-size:11px;color:var(--muted)">Debit/Credit</div>
      </div>
      <div onclick="setPayMethod('net')" id="payNet" style="border:2px solid var(--border);border-radius:10px;padding:14px;text-align:center;cursor:pointer;transition:all 0.2s">
        <div style="font-size:24px;margin-bottom:6px">ğŸ¦</div>
        <div style="font-size:13px;font-weight:600">Net Banking</div>
        <div style="font-size:11px;color:var(--muted)">All banks</div>
      </div>
      <div onclick="setPayMethod('cash')" id="payCash" style="border:2px solid var(--border);border-radius:10px;padding:14px;text-align:center;cursor:pointer;transition:all 0.2s">
        <div style="font-size:24px;margin-bottom:6px">ğŸ’µ</div>
        <div style="font-size:13px;font-weight:600">Cash</div>
        <div style="font-size:11px;color:var(--muted)">At counter</div>
      </div>
    </div>
    <button class="btn btn-danger" style="width:100%;justify-content:center;padding:13px;font-size:15px;margin-bottom:10px" onclick="confirmPayFine()">âœ… Confirm Payment</button>
    <button class="btn btn-ghost" style="width:100%;justify-content:center" onclick="closeModal('payFineModal')">Pay Later</button>
  </div>
</div>

<!-- PREMIUM PURCHASE MODAL -->
<div id="premiumModal" class="modal hidden" onclick="if(event.target===this)closeModal('premiumModal')">
  <div class="modal-content" style="max-width:460px">
    <h3 class="modal-title" id="premiumModalTitle">â­ Upgrade Plan</h3>
    <div id="premiumOption" style="background:linear-gradient(135deg,rgba(168,85,247,0.1),rgba(99,102,241,0.1));border:2px solid rgba(168,85,247,0.4);border-radius:12px;padding:18px;margin-bottom:14px;cursor:pointer" onclick="setPurchaseTarget('premium')">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div>
          <div style="font-family:'Syne',sans-serif;font-weight:800;color:var(--premium);font-size:16px">â­ Premium Plan</div>
          <div style="font-size:12px;color:var(--muted);margin-top:3px">20h free â€¢ â‚¹300/hr fine â€¢ 5 vehicles</div>
        </div>
        <div style="font-family:'Space Mono',monospace;font-size:26px;font-weight:700;color:var(--premium)">â‚¹399<span style="font-size:12px;color:var(--muted)">/2mo</span></div>
      </div>
      <div id="premiumSelectDot" style="display:none;margin-top:10px;text-align:right;font-size:12px;color:var(--premium)">âœ… Selected</div>
    </div>
    <div id="familyOption" style="background:linear-gradient(135deg,rgba(255,215,0,0.08),rgba(255,140,0,0.05));border:2px solid rgba(255,215,0,0.4);border-radius:12px;padding:18px;cursor:pointer" onclick="setPurchaseTarget('family')">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div>
          <div style="font-family:'Syne',sans-serif;font-weight:800;color:var(--gold);font-size:16px">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§ Family Pack</div>
          <div style="font-size:12px;color:var(--muted);margin-top:3px">â™¾ï¸ Unlimited hours â€¢ 3 users â€¢ Zero fines</div>
        </div>
        <div style="font-family:'Space Mono',monospace;font-size:26px;font-weight:700;color:var(--gold)">â‚¹999<span style="font-size:12px;color:var(--muted)">/2mo</span></div>
      </div>
      <div id="familySelectDot" style="display:none;margin-top:10px;text-align:right;font-size:12px;color:var(--gold)">âœ… Selected</div>
    </div>
    <div style="height:1px;background:var(--border);margin:18px 0"></div>
    <button class="btn btn-premium" style="width:100%;justify-content:center;padding:13px;font-size:15px;margin-bottom:10px" onclick="activatePlan()">ğŸš€ Activate Now</button>
    <button class="btn btn-ghost" style="width:100%;justify-content:center" onclick="closeModal('premiumModal')">Maybe Later</button>
  </div>
</div>

<!-- ADD FAMILY MEMBER MODAL -->
<div id="familyModal" class="modal hidden" onclick="if(event.target===this)closeModal('familyModal')">
  <div class="modal-content">
    <h3 class="modal-title">ğŸ‘¥ Add Family Member</h3>
    <div class="form-group"><label class="form-label">Name *</label>
      <input type="text" class="form-input" id="fmName" placeholder="Member name">
    </div>
    <div class="form-group"><label class="form-label">Email *</label>
      <input type="email" class="form-input" id="fmEmail" placeholder="member@email.com">
    </div>
    <div style="display:flex;gap:10px;margin-top:8px">
      <button class="btn btn-ghost" style="flex:1;justify-content:center" onclick="closeModal('familyModal')">Cancel</button>
      <button class="btn btn-premium" style="flex:1;justify-content:center" onclick="addFamilyMember()">âœ… Add Member</button>
    </div>
  </div>
</div>

<!-- RE-PARK MODAL -->
<div id="reParkModal" class="modal hidden" onclick="if(event.target===this)closeModal('reParkModal')">
  <div class="modal-content" style="max-width:400px">
    <h3 class="modal-title">ğŸ”„ Re-Park Vehicle</h3>
    <div id="reParkInfo" style="background:var(--bg2);border:1px solid var(--border);border-radius:10px;padding:14px;margin-bottom:16px;font-size:13px;line-height:2"></div>
    <p style="font-size:13px;color:var(--muted);margin-bottom:16px">This will pre-fill the parking form with the same vehicle, facility, and area. You'll still need to select an available slot.</p>
    <div style="display:flex;gap:10px">
      <button class="btn btn-ghost" style="flex:1;justify-content:center" onclick="closeModal('reParkModal')">Cancel</button>
      <button class="btn btn-primary" style="flex:1;justify-content:center" onclick="confirmRePark()">ğŸ”„ Go to Parking Form</button>
    </div>
  </div>
</div>

<script src="app.js" defer></script>
</body>
</html>